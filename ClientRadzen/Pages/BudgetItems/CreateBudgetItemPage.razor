@page "/CreateBudgetItem/{MWOId:guid}"


<PageTitle>Create New BudgetItem</PageTitle>

<RadzenStack Orientation="Orientation.Vertical">
    <RadzenRow>
        <RadzenText TextStyle="TextStyle.DisplayH5" Text="@($"Create new item in MWO: {Model.MWOName}")"></RadzenText>
    </RadzenRow>
    <RadzenRow>
        <AlertMessage Messages="@Model.ValidationErrors"></AlertMessage>
    </RadzenRow>
 

    <RadzenRow>
        <RadzenColumn SizeXS="8" SizeSM="4">
            <RadzenStack Orientation="Orientation.Vertical">
                <RadzenTemplateForm TItem="CreateBudgetItemRequest" Data="@Model">
                 
                    <RadzenFormField Text="Type" Style="width: 100%;">
                        <RadzenDropDown @bind-Value=@Model.Type Data=@BudgetItemTypeEnum.ListForCreateItem Style="width: 100%;"
                                        Disabled=@(Model.Type != BudgetItemTypeEnum.None)
                                        FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" FilterOperator="StringFilterOperator.StartsWith"
                                        AllowFiltering="true"
                                        Name="type" TextProperty="Name"
                                        TValue="BudgetItemTypeEnum" />
                    </RadzenFormField>

                    @if (Model.Type != BudgetItemTypeEnum.None)
                    {
                        <RadzenFormField Text="Name" Style="width: 100%;">
                            <RadzenTextBox @bind-Value=@Model.Name class="w-100"
                                           @oninput=@(args =>Model.ChangeName(args.Value!.ToString()!)) Name="name" />
                        </RadzenFormField>
                    

                        @if (Model.IsRegularData || Model.IsEquipmentData || Model.IsAlteration)
                        {

                            <RadzenFormField Text="Quantity" Style="width: 100%;">
                                <RadzenNumeric @bind-Value=@Model.Quantity class="w-100" TValue=double ShowUpDown=false
                                               InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})"
                                               Name="Quantity" @oninput=@(args =>Model.ChangeQuantity(args.Value!.ToString()!)) />

                            </RadzenFormField>

                            <RadzenFormField Text="Unitary Cost, USD" Style="width: 100%;">
                                <RadzenNumeric ShowUpDown="false" @bind-Value=@Model.UnitaryCost class="w-100" TValue=double
                                               InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})"
                                               Name="UnitaryCost" @oninput=@(args =>Model.ChangeUnitaryCost(args.Value!.ToString()!)) />

                            </RadzenFormField>

                        }
                        @if (Model.IsEquipmentData)
                        {
                            <RadzenLabel Text="Is Existing in Plant?" Component="True" />
                            <RadzenSwitch @bind-Value=@Model.Existing
                                          InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "Switch value" }})"></RadzenSwitch>
                        }
                        if (Model.IsTaxesData)
                        {
                            <RadzenFormField Text="Percentage" Style="width: 100%;">
                                <RadzenNumeric ShowUpDown="false" Value=@Model.Percentage class="w-100" TValue=double
                                               Max=100 Min=0
                                               InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})"
                                               Name="Percentage" @oninput=@(args =>Model.ChangePercentage(args.Value!.ToString()!)) />

                            </RadzenFormField>
                        }
                        if (Model.IsEngineeringData)
                        {
                            <RadzenFormField Text="Budget, USD" Style="width: 100%;">
                                <RadzenNumeric ShowUpDown="false" Value=@Model.Budget class="w-100" TValue=double
                                               InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})"
                                               Name="Percentage" @oninput=@(args =>Model.ChangeBudget(args.Value!.ToString()!)) />

                            </RadzenFormField>

                        }
                        
                        <RadzenFormField Text="Budget, USD" Style="width: 100%;">
                            <RadzenText class="rz-p-2"> @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", Model.Budget)}")</RadzenText>
                        

                        </RadzenFormField>
                      
                    }
                </RadzenTemplateForm>
            </RadzenStack>
        </RadzenColumn>
        <RadzenColumn SizeXS="8" SizeSM="4">
            <RadzenStack Orientation="Orientation.Vertical">
                <RadzenTemplateForm TItem="CreateBudgetItemRequest" Data="@Model">
                   
                    @if (Model.IsEquipmentData)
                    {
                        <RadzenFormField Text="Brand" Style="width: 100%;">
                            <RadzenDropDown @bind-Value=@Model.Brand Data=@Brands Style="width: 100%;"
                                            Name="brand" TextProperty="Name"
                                            TValue="BrandResponse" />
                        </RadzenFormField>
                        <RadzenFormField Text="Model" Style="width: 100%;">
                            <RadzenTextBox @bind-Value=@Model.Model class="w-100" Name="Model" />
                        </RadzenFormField>

                        <RadzenFormField Text="Reference" Style="width: 100%;">
                            <RadzenTextBox @bind-Value=@Model.Reference class="w-100" Name="Reference" />
                        </RadzenFormField>

                    }
                    else if (Model.IsTaxesData)
                    {
                        @if (BudgetItemDtos.Count == 0)
                        {
                            <AlertMessage Message="There is no items to apply Taxes"></AlertMessage>
                        }
                        else
                        {
                            <RadzenFormField Text="Sum taxes applied, USD" Style="width: 100%;">
                                <RadzenNumeric ShowUpDown="false" Value=@Model.SumBudgetTaxes class="w-100" TValue=double
                                               Name="Budget" Disabled=true />

                            </RadzenFormField>
                            <RadzenText Text="Items to apply taxes" Style="width: 100%;"></RadzenText>
                            <RadzenListBox AllowFiltering=true @bind-Value=@Model.BudgetItemDtos Data="@BudgetItemDtos" TextProperty="Name" TValue="List<BudgetItemDto>"
                                           Multiple=true AllowClear=true Placeholder="Select items" Style="width: 100%;  height: 200px"
                                           Change="Model.ChangeTaxesItemList"
                                           InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select items" }})" />

                           
                        }




                    }
                    else if (Model.IsEngContData)
                    {

                    }


                </RadzenTemplateForm>
            </RadzenStack>
        </RadzenColumn>
    </RadzenRow>
    <RadzenRow>
        <RadzenStack Orientation="Orientation.Horizontal">
            <RadzenButton ButtonStyle=ButtonStyle.Primary ButtonType=ButtonType.Submit Disabled=@DisableCreateButton Click="SaveAsync">Create</RadzenButton>
            <RadzenButton ButtonStyle=ButtonStyle.Primary Variant="Variant.Outlined" Click="CancelAsync">Cancel</RadzenButton>
        </RadzenStack>

    </RadzenRow>
</RadzenStack>

@code {
    void NotifyMessage(NotificationSeverity Severity, string Leyend, List<string> messages)
    {
        AlertStyle alertStyle = Severity == NotificationSeverity.Success ? AlertStyle.Success : AlertStyle.Danger;

        NotificationService.Notify(new NotificationMessage
            {
                Severity = Severity,
                SummaryContent = ns =>@<RadzenText TextStyle="TextStyle.H6">@Leyend</RadzenText>,
            DetailContent = ns =>@<SimpleAlertMessage AlertStyle="@alertStyle" Messages=@messages></SimpleAlertMessage>,


            Duration = Severity == NotificationSeverity.Success ? 2000 : 4000,
        });

    }
}
