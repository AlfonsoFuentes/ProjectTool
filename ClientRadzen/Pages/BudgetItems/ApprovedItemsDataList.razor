@page "/ApprovedItemsDataList/{MWOId:guid}"

<RadzenStack Orientation="Orientation.Vertical">
    <RadzenRow>
        <RadzenColumn Size="12" SizeLG="4">
            <RadzenPanel AllowCollapse="true" Collapsed=true Class="rz-my-10 rz-mx-auto">
                <HeaderTemplate>
                    <RadzenText TextStyle="TextStyle.H6" Class="rz-display-flex rz-align-items-center rz-m-0">
                        <b>General Info</b>
                    </RadzenText>
                </HeaderTemplate>
                <ChildContent>
                    <RadzenCard class="rz-mt-1">
                        <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Name</RadzenText>
                            <RadzenText TextStyle="TextStyle.Caption"><b>@(Response.MWO.Name)</b></RadzenText>
                        </RadzenRow>
                        <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">CEC name</RadzenText>
                            <RadzenText TextStyle="TextStyle.Caption"><b>@(Response.MWO.CECName)</b></RadzenText>
                        </RadzenRow>
                        <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Cost Center</RadzenText>
                            <RadzenText TextStyle="TextStyle.Caption"><b>@(Response.MWO.CostCenter)</b></RadzenText>
                        </RadzenRow>
                        <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Appropiation</RadzenText>
                            <RadzenText TextStyle="TextStyle.Caption">
                                <b>
                                    @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", Response.Appropiation)}")
                                </b>
                            </RadzenText>

                        </RadzenRow>
                        <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Expenses</RadzenText>
                            <RadzenText TextStyle="TextStyle.Caption">
                                <b>
                                    @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", Response.Expenses)}")
                                </b>
                            </RadzenText>

                        </RadzenRow>
                        <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Capital</RadzenText>
                            <RadzenText TextStyle="TextStyle.Caption">
                                <b>
                                    @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", Response.Capital)}")
                                </b>
                            </RadzenText>

                        </RadzenRow>
                    </RadzenCard>
                </ChildContent>
            </RadzenPanel>
        </RadzenColumn>


        <RadzenColumn Size="12" SizeLG="4">
            <RadzenPanel AllowCollapse="true" Collapsed=true Class="rz-my-10 rz-mx-auto">
                <HeaderTemplate>
                    <RadzenText TextStyle="TextStyle.H6" Class="rz-display-flex rz-align-items-center rz-m-0">
                        <b>Capital Status</b>
                    </RadzenText>
                </HeaderTemplate>
                <ChildContent>
                    <RadzenCard class="rz-mt-1">
                        <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Assigned</RadzenText>
                            <RadzenText TextStyle="TextStyle.Caption">
                                <b>
                                    @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", Response.AssignedCapital)}")
                                </b>
                            </RadzenText>

                        </RadzenRow>
                        <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Actual</RadzenText>
                            <RadzenText TextStyle="TextStyle.Caption">
                                <b>
                                    @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", Response.ActualCapital)}")
                                </b>
                            </RadzenText>

                        </RadzenRow>
                        <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Potencial</RadzenText>
                            <RadzenText TextStyle="TextStyle.Caption">
                                <b>
                                    @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", Response.PotencialCapital)}")
                                </b>
                            </RadzenText>

                        </RadzenRow>
                        <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Pending</RadzenText>
                            <RadzenText TextStyle="TextStyle.Caption">
                                <b>
                                    @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", Response.PendingCapital)}")
                                </b>
                            </RadzenText>

                        </RadzenRow>
                    </RadzenCard>
                </ChildContent>
            </RadzenPanel>
        </RadzenColumn>
        @if (Response.HasExpenses)
        {
            <RadzenColumn Size="12" SizeLG="4">
                <RadzenPanel AllowCollapse="true" Collapsed=true Class="rz-my-10 rz-mx-auto">
                    <HeaderTemplate>
                        <RadzenText TextStyle="TextStyle.H6" Class="rz-display-flex rz-align-items-center rz-m-0">
                            <b>Expenses Status</b>
                        </RadzenText>
                    </HeaderTemplate>
                    <ChildContent>
                        <RadzenCard class="rz-mt-1">
                            <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                                <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Assigned</RadzenText>
                                <RadzenText TextStyle="TextStyle.Caption">
                                    <b>
                                        @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", Response.AssignedExpenses)}")
                                    </b>
                                </RadzenText>

                            </RadzenRow>
                            <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                                <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Actual</RadzenText>
                                <RadzenText TextStyle="TextStyle.Caption">
                                    <b>
                                        @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", Response.ActualExpenses)}")
                                    </b>
                                </RadzenText>

                            </RadzenRow>
                            <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                                <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Potencial</RadzenText>
                                <RadzenText TextStyle="TextStyle.Caption">
                                    <b>
                                        @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", Response.PotencialExpenses)}")
                                    </b>
                                </RadzenText>

                            </RadzenRow>
                            <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                                <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Pending</RadzenText>
                                <RadzenText TextStyle="TextStyle.Caption">
                                    <b>
                                        @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", Response.PendingExpenses)}")
                                    </b>
                                </RadzenText>

                            </RadzenRow>
                        </RadzenCard>
                    </ChildContent>
                </RadzenPanel>
            </RadzenColumn>

        }
    </RadzenRow>
    <RadzenRow class="rz-ml-4">
        <RadzenColumn Size="12" SizeLG="8">
            <RadzenStack Orientation="Orientation.Horizontal">

                <RadzenButton Icon="home" ButtonStyle="ButtonStyle.Light" Size="ButtonSize.Medium" Class="rz-mr-2" Click="@(()=>GoToHome())"
                              MouseEnter="@(args => MainApp.ShowTooltip(args,$"Go to Home Page", TooltipPosition.Right) )" />
                <RadzenButton Icon="list_alt" ButtonStyle="ButtonStyle.Light" Size="ButtonSize.Medium" Class="rz-mr-2" Click="@(()=>GoToMWOPage())"
                              MouseEnter="@(args => MainApp.ShowTooltip(args,$"Go to MWO's page", TooltipPosition.Right) )" />


            </RadzenStack>

        </RadzenColumn>
        <RadzenColumn Size="12" SizeLG="4">
            <RadzenTextBox Class="rz-ml-4" Style="width:100%;" Placeholder="Search..." @bind-Value="@nameFilter" @oninput=@((arg)=>nameFilter=arg.Value!.ToString()!)></RadzenTextBox>
        </RadzenColumn>
    </RadzenRow>

    <RadzenRow>
        <RadzenColumn Size="12" SizeLG="12">
            <RadzenDataList AllowVirtualization=true Style="height:700px;overflow:auto;"
                            WrapItems="false" AllowPaging="true" Density="Density.Compact"
                            Data="@FilteredItems" TItem="BudgetItemApprovedResponse" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
                <Template Context="product">
                    <RadzenCard Style="width: 100%; padding: 0;">
                        <RadzenRow Gap="0">
                            <RadzenColumn Size="12" SizeLG="2" Class="rz-p-4">

                                <RadzenRow Style="width:100%" JustifyContent="JustifyContent.SpaceBetween">
                                    <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Nomenclatore</RadzenText>
                                    <RadzenText TextStyle="TextStyle.Caption"><b>@(product.Nomenclatore)</b></RadzenText>
                                </RadzenRow>
                                <RadzenRow Style="width:100%">
                                    <RadzenText TextStyle="TextStyle.H6" TagName="TagName.H5" Class="rz-color-black" Style="width:100%;">@(product.ComposedName)</RadzenText>
                                </RadzenRow>


                            </RadzenColumn>
                            <RadzenColumn Size="12" SizeLG="8" Class="rz-p-4">
                                <RadzenRow Gap="0">
                                    <RadzenColumn Size="12" SizeMD="6" SizeLG="2" class="rz-p-1">
                                        <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5" Class="rz-mb-0">Type</RadzenText>
                                        <RadzenText TextStyle="TextStyle.Caption"><b>@(product.Type.Name)</b></RadzenText>


                                    </RadzenColumn>
                                    <RadzenColumn Size="12" SizeMD="6" SizeLG="3" class="rz-p-1">
                                        <RadzenRow JustifyContent="JustifyContent.SpaceBetween" Style="width:100%" Class="rz-p-1">
                                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5">Budget, USD</RadzenText>
                                            <RadzenText TextStyle="TextStyle.Caption"><b>@($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", product.Budget)}")</b></RadzenText>

                                        </RadzenRow>
                                        <RadzenRow JustifyContent="JustifyContent.SpaceBetween" Style="width:100%" Class="rz-p-1">

                                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5">Assigned, USD</RadzenText>
                                            <RadzenText TextStyle="TextStyle.Caption"><b>@($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", product.Assigned)}")</b></RadzenText>

                                        </RadzenRow>
                                        <RadzenRow JustifyContent="JustifyContent.SpaceBetween" Style="width:100%" Class="rz-p-1">

                                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5">Pending, USD</RadzenText>
                                            <RadzenText TextStyle="TextStyle.Caption"><b>@($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", product.Pending)}")</b></RadzenText>

                                        </RadzenRow>


                                    </RadzenColumn>
                                    <RadzenColumn Size="12" SizeMD="6" SizeLG="3" class="rz-p-1">
                                        <RadzenRow JustifyContent="JustifyContent.SpaceBetween" Style="width:100%" Class="rz-p-1">
                                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5">Actual , USD</RadzenText>
                                            <RadzenText TextStyle="TextStyle.Caption">
                                                <b>
                                                    @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", product.Actual)}")
                                                </b>
                                            </RadzenText>

                                        </RadzenRow>
                                        <RadzenRow JustifyContent="JustifyContent.SpaceBetween" Style="width:100%" Class="rz-p-1">

                                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5">Commitment, USD</RadzenText>
                                            <RadzenText TextStyle="TextStyle.Caption">
                                                <b>@($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", product.Commitment)}")</b>
                                            </RadzenText>

                                        </RadzenRow>
                                        <RadzenRow JustifyContent="JustifyContent.SpaceBetween" Style="width:100%" Class="rz-p-1">

                                            <RadzenText TextStyle="TextStyle.Caption" TagName="TagName.H5">Potential, USD</RadzenText>
                                            <RadzenText TextStyle="TextStyle.Caption"><b>@($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", product.Potencial)}")</b></RadzenText>

                                        </RadzenRow>

                                    </RadzenColumn>

                                </RadzenRow>
                            </RadzenColumn>
                            <RadzenColumn Size="12" SizeLG="2" Class="rz-p-4">
                                <RadzenStack Orientation="Orientation.Horizontal">
                                    @if (product.CanCreatePurchaseOrder)
                                    {
                                        <RadzenButton Icon="add_shopping_cart" ButtonStyle="ButtonStyle.Light" Size="ButtonSize.Medium" class="rz-mr-1"
                                                      Click="@(()=>CreatePurchaseOrder(product))" MouseEnter="@(args =>MainApp.ShowTooltip(args,$"Create PR", TooltipPosition.Left) )" />
                                    }

                                    @if (product.PurchaseOrders.Count > 0)
                                    {
                                        @if (seletedRow == product)
                                        {
                                            <RadzenButton Icon="filter_list_off" ButtonStyle="ButtonStyle.Light" Size="ButtonSize.Medium" class="rz-ml-2"
                                                          Click="@(()=>HidePurchaseOrders())" MouseEnter="@(args =>MainApp.ShowTooltip(args,$"Hide POs for {product.Name}", TooltipPosition.Left) )" />

                                        }
                                        else
                                        {
                                            <RadzenButton Icon="filter_list" ButtonStyle="ButtonStyle.Light" Size="ButtonSize.Medium" class="rz-ml-2"
                                                          Click="@(()=>ShowPurchaseOrders(product))" MouseEnter="@(args => MainApp.ShowTooltip(args,$"Show POs for {product.Name}", TooltipPosition.Left) )" />

                                        }




                                    }

                                </RadzenStack>
                            </RadzenColumn>
                        </RadzenRow>
                    </RadzenCard>
                    @if (product == seletedRow)
                    {
                        <RadzenCard Style="width: 100%;" class="m-1">
                            <RadzenDataGrid AllowFiltering="false" AllowColumnResize="false" AllowAlternatingRows="false"
                                            AllowGrouping="false" AllowSorting="false" PageSize="50" AllowPaging="true" PagerHorizontalAlign="HorizontalAlign.Left"
                                            Density="Density.Compact" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                                            FilterPopupRenderMode="PopupRenderMode.OnDemand"
                                            Data="@product.PurchaseOrders" TItem="PurchaseOrderResponse" ColumnWidth="300px" LogicalFilterOperator="LogicalFilterOperator.Or" ShowPagingSummary="true">
                                <Columns>
                                    <RadzenDataGridColumn TItem="PurchaseOrderResponse"
                                                          Property="@nameof(PurchaseOrderResponse.PurchaseorderName)"
                                                          Title="Name" Width="150px" TextAlign="TextAlign.Left" />
                                    <RadzenDataGridColumn TItem="PurchaseOrderResponse"
                                                          Title="Status" Width="70px" TextAlign="TextAlign.Left">
                                        <Template Context="detail">
                                            @detail.PurchaseOrderStatus.Name
                                        </Template>
                                    </RadzenDataGridColumn>
                                    <RadzenDataGridColumn TItem="PurchaseOrderResponse"
                                                          Property="@nameof(PurchaseOrderResponse.PurchaseRequisition)"
                                                          Title="PR" Width="100px" TextAlign="TextAlign.Left" />
                                    <RadzenDataGridColumn TItem="PurchaseOrderResponse"
                                                          Property="@nameof(PurchaseOrderResponse.PONumber)"
                                                          Title="PO Number" Width="100px" TextAlign="TextAlign.Left" />
                                    <RadzenDataGridColumn TItem="PurchaseOrderResponse"
                                                          Property="@nameof(PurchaseOrderResponse.Supplier)"
                                                          Title="Supplier" Width="100px" TextAlign="TextAlign.Left" />
                                    <RadzenDataGridColumn TItem="PurchaseOrderResponse"
                                                          Property="@nameof(PurchaseOrderResponse.POValueUSD)"
                                                          Title="PO Value, USD" Width="100px" TextAlign="TextAlign.Left">
                                        <Template Context="detail">
                                            @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", detail.POValueUSD)}")

                                        </Template>
                                    </RadzenDataGridColumn>
                                    <RadzenDataGridColumn TItem="PurchaseOrderResponse"
                                                          Property="@nameof(PurchaseOrderResponse.Actual)"
                                                          Title="Actual, USD" Width="100px" TextAlign="TextAlign.Left">
                                        <Template Context="detail">
                                            @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", detail.Actual)}")

                                        </Template>
                                    </RadzenDataGridColumn>
                                    <RadzenDataGridColumn TItem="PurchaseOrderResponse"
                                                          Property="@nameof(PurchaseOrderResponse.Commitment)"
                                                          Title="Pending, USD" Width="100px" TextAlign="TextAlign.Left">
                                        <Template Context="detail">
                                            @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", detail.Commitment)}")

                                        </Template>
                                    </RadzenDataGridColumn>
                                    <RadzenDataGridColumn TItem="PurchaseOrderResponse"
                                                          Property="@nameof(PurchaseOrderResponse.Potencial)"
                                                          Title="Potencial, USD" Width="100px" TextAlign="TextAlign.Left">
                                        <Template Context="detail">
                                            @($"{String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", detail.Potencial)}")

                                        </Template>
                                    </RadzenDataGridColumn>
                                    @if (!product.IsMainItemTaxesNoProductive)
                                    {
                                        <RadzenDataGridColumn TItem="PurchaseOrderResponse"
                                                              Title="Actions" Width="100px" TextAlign="TextAlign.Left">
                                            <Template Context="order">

                                                <RadzenButton ButtonStyle="ButtonStyle.Light" Icon="edit" Variant="Variant.Flat" Shade="Shade.Lighter"
                                                              Size="ButtonSize.ExtraSmall" class="my-1 ms-1"
                                                              Click="@(args => EditPurchaseOrder(order))" @onclick:stopPropagation="true"
                                                              MouseEnter="@(args => MainApp.ShowTooltip(args,$"{order.LabelAction}", TooltipPosition.Left))">
                                                </RadzenButton>


                                                @if (order.PurchaseOrderStatus.Id == PurchaseOrderStatusEnum.Created.Id)
                                                {

                                                    <RadzenButton ButtonStyle="ButtonStyle.Light" Icon="done_outline" Variant="Variant.Flat" Shade="Shade.Lighter"
                                                                  Size="ButtonSize.ExtraSmall" class="my-1 ms-1"
                                                                  Click="@(args => ApprovedPurchaseOrder(order))" @onclick:stopPropagation="true"
                                                                  MouseEnter="@(args => MainApp.ShowTooltip(args,$"Approve {order.PurchaseRequisition}", TooltipPosition.Left))">
                                                    </RadzenButton>

                                                }
                                                else if (order.PurchaseOrderStatus.Id == PurchaseOrderStatusEnum.Approved.Id ||
                                                order.PurchaseOrderStatus.Id == PurchaseOrderStatusEnum.Receiving.Id)
                                                {

                                                    <RadzenButton ButtonStyle="ButtonStyle.Light" Icon="shopping_bag" Variant="Variant.Flat" Shade="Shade.Lighter"
                                                                  Size="ButtonSize.ExtraSmall" class="my-1 ms-1"
                                                                  Click="@(args => ReceivePurchaseOrder(order))" @onclick:stopPropagation="true"
                                                                  MouseEnter="@(args =>MainApp.ShowTooltip(args,$"Receive {order.PONumber}", TooltipPosition.Left))">
                                                    </RadzenButton>
                                                }
                                                else
                                                {

                                                }
                                            </Template>
                                        </RadzenDataGridColumn>
                                    }

                                </Columns>
                            </RadzenDataGrid>

                        </RadzenCard>
                    }

                </Template>

            </RadzenDataList>
        </RadzenColumn>
    </RadzenRow>




</RadzenStack>
@code {


}
