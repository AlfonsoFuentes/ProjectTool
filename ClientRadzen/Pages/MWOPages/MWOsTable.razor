@page "/mwotable"
@using Shared.Models.MWOStatus

<PageTitle>MWO List</PageTitle>
<RadzenStack Orientation="Orientation.Vertical">

    <RadzenRow>
        <RadzenText TextStyle="TextStyle.H5">MWO List</RadzenText>

    </RadzenRow>
    <RadzenRow>
        <RadzenStack Orientation="Orientation.Horizontal">
            <RadzenButton ButtonStyle="ButtonStyle.Primary" class="mt-2 mb-4" Text="Add New" Click="@AddNewMWO" />
            <RadzenButton ButtonStyle="ButtonStyle.Primary" class="mt-2 mb-4" Text="Manage Items" Click="@(()=>ShowBudgetItems(selectedRow))" Disabled=@(selectedRow==null) />
            @if (selectedRow != null && selectedRow.Status.Id == MWOStatusEnum.Created.Id)
            {
                <RadzenButton ButtonStyle="ButtonStyle.Primary" class="mt-2 mb-4" Text="Edit" Click="@(()=>Edit(selectedRow))" Disabled=@(selectedRow==null) />
                <RadzenButton ButtonStyle="ButtonStyle.Primary" class="mt-2 mb-4" Text="Approve" Click="@(()=>Approve(selectedRow))" Disabled=@(selectedRow==null) />
                <RadzenButton ButtonStyle="ButtonStyle.Primary" class="mt-2 mb-4" Text="Delete" Click="@(()=>Delete(selectedRow))" Disabled=@(selectedRow==null) />


            }
            else
            {

            }

           
        </RadzenStack>

    </RadzenRow>
    <RadzenRow>
        <RadzenDataGrid @ref="grid" AllowFiltering="true" AllowColumnResize="true" AllowAlternatingRows="false" FilterMode="FilterMode.Advanced"
                        AllowGrouping="true" AllowSorting="true" PageSize="10" AllowPaging="true" PagerHorizontalAlign="HorizontalAlign.Left"
                        AllowVirtualization=true Style="height:800px" Responsive=true
                        Density="Density.Default" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" FilterCleared=@FilterCleared
                        FilterPopupRenderMode="PopupRenderMode.OnDemand" SelectionMode="DataGridSelectionMode.Single" @bind-Value=@selectedMWOs RowClick=OnRowClick
                        Data="@FilteredItems" TItem="MWOResponse" ColumnWidth="300px" LogicalFilterOperator="LogicalFilterOperator.Or" ShowPagingSummary="true">
            <Columns>
                <RadzenDataGridColumn TItem="MWOResponse" Property="@nameof(MWOResponse.Name)" Filterable="false" Title="Name" Frozen="false" Width="150px"
                                      TextAlign="TextAlign.Left" Groupable=false />
                <RadzenDataGridColumn TItem="MWOResponse" Property="@nameof(MWOResponse.Type)" Title="Type" Frozen="false"
                                      Width="80px" TextAlign="TextAlign.Center" Type="typeof(IEnumerable<string>)" LogicalFilterOperator=LogicalFilterOperator.Or
                                      FilterValue="@selectedTypes" FilterOperator="FilterOperator.Contains">
                    <FilterValueTemplate>
                        <RadzenDropDown @bind-Value=@selectedTypes Style="width:100%"
                                        Change=@OnSelectedTypesChange Data="@(titles)" AllowClear="true" Multiple="true" />
                    </FilterValueTemplate>


                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="MWOResponse" Property="@nameof(MWOResponse.CECName)" Title="CEC#" Frozen="false" Groupable=false Width="80px">
                    <Template Context="detail">
                        @detail.CECName
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="MWOResponse" Property="@nameof(MWOResponse.Status.Name)" Title="Status" Frozen="false" Width="80px">
                    <Template Context="detail">
                        @detail.Status.Name
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="MWOResponse" Property="@nameof(MWOResponse.Appropiation)" Title="Appropiation" Frozen="false" Width="80px"
                                      Groupable=false Filterable=false>
                    <Template Context="detail">
                        @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", detail.Appropiation)
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="MWOResponse" Property="@nameof(MWOResponse.Capital)" Title="Capital" Frozen="false" Width="80px"
                                      Groupable=false Filterable=false>
                    <Template Context="detail">
                        @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", detail.Capital)
                    </Template>
                </RadzenDataGridColumn>
                <RadzenDataGridColumn TItem="MWOResponse" Property="@nameof(MWOResponse.Expenses)" Title="Expenses" Frozen="false" Width="80px"
                                      Groupable=false Filterable=false>
                    <Template Context="detail">
                        @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", detail.Expenses)
                    </Template>
                </RadzenDataGridColumn>
                @if (CurrentUser.IsSuperAdmin)
                {
                    <RadzenDataGridColumn TItem="MWOResponse" Property="@nameof(MWOResponse.CreatedBy)" Filterable="false" Title="Created By" Frozen="false" Width="100px"
                                          TextAlign="TextAlign.Left" Groupable=false />
                    <RadzenDataGridColumn TItem="MWOResponse" Property="@nameof(MWOResponse.CreatedOn)" Filterable="false" Title="Created On" Frozen="false" Width="100px"
                                          TextAlign="TextAlign.Left" Groupable=false />

                }
            </Columns>
        </RadzenDataGrid>
    </RadzenRow>
</RadzenStack>
@code {

}
