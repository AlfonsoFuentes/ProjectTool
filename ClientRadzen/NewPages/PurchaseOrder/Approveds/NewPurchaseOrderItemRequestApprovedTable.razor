@if (Model != null)
{
    <RadzenRow class="rz-mt-2">
        <RadzenColumn Size="12" SizeMD="MaxColumn">
            <RadzenDataGrid @ref="ordersGrid" AllowAlternatingRows="false" AllowFiltering="false" AllowPaging="true" PageSize="5"
                            AllowSorting="false" EditMode="DataGridEditMode.Single" Density="@Density" AllowRowSelectOnRowClick=true
                            Data="@MainPage.PurchaseOrderItems" TItem="NewPurchaseOrderCreateItemRequest"  Responsive=true
                            
                            ColumnWidth="200px">

                <Columns>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderCreateItemRequest"
                                          Property="@nameof(NewPurchaseOrderCreateItemRequest.BudgetItem.NomenclatoreName)"
                                          Title="Budget Item" Width="70px">
                        <Template Context="detail">
                            @if (detail.BudgetItemId == Guid.Empty)
                            {
                                @("Add Item")
                            }
                            else
                            {
                                @detail.BudgetItem.NomenclatoreName
                            }

                        </Template>
                       

                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderCreateItemRequest" Property="@nameof(NewPurchaseOrderCreateItemRequest.Name)"
                                          Title="PO Item Name" Width="70px">
                      
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderCreateItemRequest"
                                          Property="@nameof(NewPurchaseOrderCreateItemRequest.Quantity)"
                                          Title="Qty" Width="30px">
                        <Template Context="order">
                            @if (order.BudgetItemId != Guid.Empty)
                            {
                                @order.Quantity

                            }
                        </Template>
                        
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderCreateItemRequest"
                                          Property="@nameof(NewPurchaseOrderCreateItemRequest.ItemQuoteValueCurrency)"
                                          Title="@($"Value, {Model.QuoteCurrency.Name}")"
                                          Width="70px">
                        <Template Context="detail">
                            @if (detail.BudgetItemId != Guid.Empty)
                            {
                                @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C0}", detail.ItemQuoteValueCurrency)

                            }

                        </Template>
                       
                        <FooterTemplate>
                            <b>@($"{String.Format(new CultureInfo("en-US"), "{0:C0}", Model.POValueCurrency)}")</b>
                        </FooterTemplate>
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderCreateItemRequest"
                                          Title="@($"Value, {Model.PurchaseOrderCurrency.Name}")" Width="30px"
                                          Visible="@(!IsSameCurrency)">
                        <Template Context="detail">
                            @if (detail.BudgetItemId != Guid.Empty)
                            {
                                @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C0}", detail.UnitaryValueCurrency)
                            }

                        </Template>
                        <EditTemplate Context="order">
                            @if (order.BudgetItemId != Guid.Empty)
                            {
                                @String.Format(new CultureInfo("en-US"), "{0:C0}", order.UnitaryValueCurrency)
                            }

                        </EditTemplate>

                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderCreateItemRequest"
                                          Property="@nameof(NewPurchaseOrderCreateItemRequest.ItemQuoteValueUSD)"
                                          Title="Total, USD" Width="30px">
                        <Template Context="detail">
                            @if (detail.BudgetItemId != Guid.Empty)
                            {
                                @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C0}", detail.ItemQuoteValueUSD)
                            }

                        </Template>
                        <EditTemplate Context="order">
                            @if (order.BudgetItemId != Guid.Empty)
                            {
                                @String.Format(new CultureInfo("en-US"), "{0:C0}", order.ItemQuoteValueUSD)
                            }

                        </EditTemplate>
                        <FooterTemplate>
                            <b>@($"{String.Format(new CultureInfo("en-US"), "{0:C0}", Model.POValueUSD)}")</b>
                        </FooterTemplate>
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderCreateItemRequest"
                                          Property="@nameof(NewPurchaseOrderCreateItemRequest.BudgetUSD)"
                                          Title="Budget" Width="30px">
                        <Template Context="detail">
                            @if (detail.BudgetItemId != Guid.Empty)
                            {
                                @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C0}", detail.BudgetUSD)
                            }

                        </Template>
                        <EditTemplate Context="order">
                            @if (order.BudgetItemId != Guid.Empty)
                            {
                                @String.Format(new CultureInfo("en-US"), "{0:C0}", order.BudgetUSD)
                            }
                        </EditTemplate>
                        <FooterTemplate>
                            <b>@($"{String.Format(new CultureInfo("en-US"), "{0:C0}", Model.TotalBudgetUSD)}")</b>
                        </FooterTemplate>
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderCreateItemRequest"
                                          Property="@nameof(NewPurchaseOrderCreateItemRequest.BudgetAssignedUSD)"
                                          Title="Assigned" Width="30px">
                        <Template Context="detail">
                            @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C0}", detail.BudgetAssignedUSD)
                        </Template>
                        <EditTemplate Context="order">
                            @String.Format(new CultureInfo("en-US"), "{0:C0}", order.BudgetAssignedUSD)
                        </EditTemplate>
                        <FooterTemplate>
                            <b>@($"{String.Format(new CultureInfo("en-US"), "{0:C0}", Model.NewTotalAssignedUSD)}")</b>
                        </FooterTemplate>
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderCreateItemRequest"
                                          Property="@nameof(NewPurchaseOrderCreateItemRequest.NewPotentialUSD)"
                                          Title="Potential" Width="30px">
                        <Template Context="detail">
                            @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C0}", detail.NewPotentialUSD)
                        </Template>
                        <EditTemplate Context="order">
                            @String.Format(new CultureInfo("en-US"), "{0:C0}", order.NewPotentialUSD)
                        </EditTemplate>
                        <FooterTemplate>
                            <b>@($"{String.Format(new CultureInfo("en-US"), "{0:C0}", Model.NewTotalPotentialUSD)}")</b>
                        </FooterTemplate>
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderCreateItemRequest"
                                          Property="@nameof(NewPurchaseOrderCreateItemRequest.PendingToCommitmUSD)"
                                          Title="Pending" Width="30px">
                        <Template Context="detail">
                            @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C0}", detail.PendingToCommitmUSD)
                        </Template>
                        <EditTemplate Context="order">
                            @String.Format(new CultureInfo("en-US"), "{0:C0}", order.PendingToCommitmUSD)
                        </EditTemplate>
                        <FooterTemplate>
                            <b>@($"{String.Format(new CultureInfo("en-US"), "{0:C0}", Model.NewTotalPendingToCommitUSD)}")</b>
                        </FooterTemplate>
                    </RadzenDataGridColumn>


                </Columns>
            </RadzenDataGrid>
        </RadzenColumn>
    </RadzenRow>
}

@code {
    bool IsSameCurrency => Model == null ? false : Model.QuoteCurrency.Id == Model.PurchaseOrderCurrency.Id;
}
