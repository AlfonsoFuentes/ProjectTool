@if (Model != null)
{
    <RadzenRow class="rz-mt-2">
        <RadzenColumn Size="12" SizeMD="MaxColumn">
            <RadzenDataGrid @ref="ordersGrid" AllowAlternatingRows="false" AllowFiltering="false" AllowPaging="true" PageSize="5"
                            AllowSorting="false" EditMode="DataGridEditMode.Single" Density="@Density" AllowRowSelectOnRowClick=true
                            Data="@Model.PurchaseOrderItems" TItem="NewPurchaseOrderReceiveItemRequest" RowDoubleClick=EditRow Responsive=true
                            CellClick=ClickCell
                            
                            ColumnWidth="200px">

                <Columns>
                   
                    <RadzenDataGridColumn TItem="NewPurchaseOrderReceiveItemRequest" Property="@nameof(NewPurchaseOrderReceiveItemRequest.Name)"
                                          Title="PO Item Name" Width="50px">
                      
                    </RadzenDataGridColumn>
               
                    <RadzenDataGridColumn TItem="NewPurchaseOrderReceiveItemRequest"
                                          Property="@nameof(NewPurchaseOrderReceiveItemRequest.ItemQuoteValueCurrency)"
                                          Title="@($"Value, {Model.QuoteCurrency.Name}")"
                                          Width="30px">
                        <Template Context="detail">
                            @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C0}", detail.ItemQuoteValueCurrency)

                        </Template>
                        <EditTemplate Context="order">
                            @String.Format(new CultureInfo("en-US"), "{0:C0}", order.ItemQuoteValueCurrency)
                        </EditTemplate>
                        <FooterTemplate>
                            <b>@($"{String.Format(new CultureInfo("en-US"), "{0:C0}", Model.POValueCurrency)}")</b>
                        </FooterTemplate>
                    </RadzenDataGridColumn>
                    
                    <RadzenDataGridColumn TItem="NewPurchaseOrderReceiveItemRequest"
                                          Property="@nameof(NewPurchaseOrderReceiveItemRequest.ReceivingCurrency)"
                                          Title="@($"Receiving, {Model.PurchaseOrderCurrency.Name}")" Width="30px">
                        <Template Context="detail">
                            @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C0}", detail.ReceivingCurrency)
                        </Template>
                        <EditTemplate Context="order">
                            <RadzenNumeric ShowUpDown=false @bind-Value=@order.ReceivingCurrency
                                           @oninput="@((arg)=>MainPage.ChangeReceiving(order,arg.Value!.ToString()!))">
                            </RadzenNumeric>

                          
                        </EditTemplate>
                        <FooterTemplate>
                            <b>@($"{String.Format(new CultureInfo("en-US"), "{0:C0}", Model.ReceivingCurrency)}")</b>
                        </FooterTemplate>
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderReceiveItemRequest"
                                          Property="@nameof(NewPurchaseOrderReceiveItemRequest.ReceivingUSD)"
                                          Title="Receiving USD" Width="30px">
                        <Template Context="detail">
                            @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C0}", detail.ReceivingUSD)
                        </Template>
                        <EditTemplate Context="order">
                            @String.Format(new CultureInfo("en-US"), "{0:C0}", order.ReceivingUSD)
                        </EditTemplate>
                        <FooterTemplate>
                            <b>@($"{String.Format(new CultureInfo("en-US"), "{0:C0}", Model.ReceivingUSD)}")</b>
                        </FooterTemplate>
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderReceiveItemRequest"
                                          Property="@nameof(NewPurchaseOrderReceiveItemRequest.ActualCurrency)"
                                          Title="@($"Actual, {Model.PurchaseOrderCurrency.Name}")" Width="30px">
                        <Template Context="detail">
                            @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C0}", detail.NewActualCurrency)
                        </Template>
                        <EditTemplate Context="order">
                            @String.Format(new CultureInfo("en-US"), "{0:C0}", order.NewActualCurrency)
                        </EditTemplate>
                        <FooterTemplate>
                            <b>@($"{String.Format(new CultureInfo("en-US"), "{0:C0}", Model.ActualCurrency)}")</b>
                        </FooterTemplate>
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderReceiveItemRequest"
                                          Property="@nameof(NewPurchaseOrderReceiveItemRequest.ActualUSD)"
                                          Title="Actual USD" Width="30px">
                        <Template Context="detail">
                            @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C0}", detail.NewActualUSD)
                        </Template>
                        <EditTemplate Context="order">
                            @String.Format(new CultureInfo("en-US"), "{0:C0}", order.NewActualUSD)
                        </EditTemplate>
                        <FooterTemplate>
                            <b>@($"{String.Format(new CultureInfo("en-US"), "{0:C0}", Model.ActualUSD)}")</b>
                        </FooterTemplate>
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderReceiveItemRequest"
                                          Property="@nameof(NewPurchaseOrderReceiveItemRequest.NewPendingCurrency)"
                                          Title="@($"Pending, {Model.PurchaseOrderCurrency.Name}")" Width="30px">
                        <Template Context="detail">
                            @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C0}", detail.NewPendingCurrency)
                        </Template>
                        <EditTemplate Context="order">
                            @String.Format(new CultureInfo("en-US"), "{0:C0}", order.NewPendingCurrency)
                        </EditTemplate>
                        <FooterTemplate>
                            <b>@($"{String.Format(new CultureInfo("en-US"), "{0:C0}", Model.PendingCurrency)}")</b>
                        </FooterTemplate>
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderReceiveItemRequest"
                                          Property="@nameof(NewPurchaseOrderReceiveItemRequest.NewPendingUSD)"
                                          Title="Pending USD" Width="30px">
                        <Template Context="detail">
                            @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C0}", detail.NewPendingUSD)
                        </Template>
                        <EditTemplate Context="order">
                            @String.Format(new CultureInfo("en-US"), "{0:C0}", order.NewPendingUSD)
                        </EditTemplate>
                        <FooterTemplate>
                            <b>@($"{String.Format(new CultureInfo("en-US"), "{0:C0}", Model.PendingUSD)}")</b>
                        </FooterTemplate>
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="NewPurchaseOrderReceiveItemRequest" Context="order" Filterable="false" Sortable="false"
                                          TextAlign="TextAlign.Right" Width="25px">
                        <Template Context="order">
                            <RadzenButton Icon="edit" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.ExtraSmall"
                                          MouseEnter="@(args => MainApp.ShowTooltip(args,$"Edit", TooltipPosition.Top) )"
                                          Click="@(args => EditRowButton(order))" @onclick:stopPropagation="true">
                            </RadzenButton>
                        </Template>
                        <EditTemplate Context="order">
                            <RadzenButton Icon="check" ButtonStyle="ButtonStyle.Success" Variant="Variant.Flat" Size="ButtonSize.ExtraSmall"
                                          Click="@((args) => SaveRow(order))" MouseEnter="@(args => MainApp.ShowTooltip(args,$"Save", TooltipPosition.Top) )">
                            </RadzenButton>
                            <RadzenButton Icon="close" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.ExtraSmall"
                                          class="my-1 ms-1" Click="@((args) => CancelEdit(order))" MouseEnter="@(args => MainApp.ShowTooltip(args,$"Cancel", TooltipPosition.Left) )">
                            </RadzenButton>
                        </EditTemplate>
                    </RadzenDataGridColumn>

                </Columns>
            </RadzenDataGrid>
        </RadzenColumn>
    </RadzenRow>
}

@code {
    bool IsSameCurrency => Model == null ? false : Model.QuoteCurrency.Id == Model.PurchaseOrderCurrency.Id;
}
